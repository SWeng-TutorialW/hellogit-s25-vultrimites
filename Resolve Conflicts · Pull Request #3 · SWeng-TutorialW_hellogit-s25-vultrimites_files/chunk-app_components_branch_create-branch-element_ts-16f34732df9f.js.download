"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_branch_create-branch-element_ts"],{97797:(e,t,r)=>{function n(){if(!(this instanceof n))return new n;this.size=0,this.uid=0,this.selectors=[],this.selectorObjects={},this.indexes=Object.create(this.indexes),this.activeIndexes=[]}r.d(t,{h:()=>k,A:()=>T,on:()=>R});var o,s=window.document.documentElement,i=s.matches||s.webkitMatchesSelector||s.mozMatchesSelector||s.oMatchesSelector||s.msMatchesSelector;n.prototype.matchesSelector=function(e,t){return i.call(e,t)},n.prototype.querySelectorAll=function(e,t){return t.querySelectorAll(e)},n.prototype.indexes=[];var a=/^#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;n.prototype.indexes.push({name:"ID",selector:function(e){var t;if(t=e.match(a))return t[0].slice(1)},element:function(e){if(e.id)return[e.id]}});var c=/^\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;n.prototype.indexes.push({name:"CLASS",selector:function(e){var t;if(t=e.match(c))return t[0].slice(1)},element:function(e){var t=e.className;if(t){if("string"==typeof t)return t.split(/\s/);if("object"==typeof t&&"baseVal"in t)return t.baseVal.split(/\s/)}}});var l=/^((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;n.prototype.indexes.push({name:"TAG",selector:function(e){var t;if(t=e.match(l))return t[0].toUpperCase()},element:function(e){return[e.nodeName.toUpperCase()]}}),n.prototype.indexes.default={name:"UNIVERSAL",selector:function(){return!0},element:function(){return[!0]}},o="function"==typeof window.Map?window.Map:function(){function e(){this.map={}}return e.prototype.get=function(e){return this.map[e+" "]},e.prototype.set=function(e,t){this.map[e+" "]=t},e}();var u=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g;function h(e,t){var r,n,o,s,i,a,c=(e=e.slice(0).concat(e.default)).length,l=t,h=[];do if(u.exec(""),(o=u.exec(l))&&(l=o[3],o[2]||!l)){for(r=0;r<c;r++)if(i=(a=e[r]).selector(o[1])){for(n=h.length,s=!1;n--;)if(h[n].index===a&&h[n].key===i){s=!0;break}s||h.push({index:a,key:i});break}}while(o)return h}function p(e,t){return e.id-t.id}n.prototype.logDefaultIndexUsed=function(){},n.prototype.add=function(e,t){var r,n,s,i,a,c,l,u,p=this.activeIndexes,d=this.selectors,f=this.selectorObjects;if("string"==typeof e){for(n=0,f[(r={id:this.uid++,selector:e,data:t}).id]=r,l=h(this.indexes,e);n<l.length;n++)i=(u=l[n]).key,(a=function(e,t){var r,n,o;for(r=0,n=e.length;r<n;r++)if(o=e[r],t.isPrototypeOf(o))return o}(p,s=u.index))||((a=Object.create(s)).map=new o,p.push(a)),s===this.indexes.default&&this.logDefaultIndexUsed(r),(c=a.map.get(i))||(c=[],a.map.set(i,c)),c.push(r);this.size++,d.push(e)}},n.prototype.remove=function(e,t){if("string"==typeof e){var r,n,o,s,i,a,c,l,u=this.activeIndexes,p=this.selectors=[],d=this.selectorObjects,f={},m=1==arguments.length;for(o=0,r=h(this.indexes,e);o<r.length;o++)for(n=r[o],s=u.length;s--;)if(a=u[s],n.index.isPrototypeOf(a)){if(c=a.map.get(n.key))for(i=c.length;i--;)(l=c[i]).selector===e&&(m||l.data===t)&&(c.splice(i,1),f[l.id]=!0);break}for(o in f)delete d[o],this.size--;for(o in d)p.push(d[o].selector)}},n.prototype.queryAll=function(e){if(!this.selectors.length)return[];var t,r,n,o,s,i,a,c,l={},u=[],h=this.querySelectorAll(this.selectors.join(", "),e);for(t=0,n=h.length;t<n;t++)for(r=0,s=h[t],o=(i=this.matches(s)).length;r<o;r++)l[(c=i[r]).id]?a=l[c.id]:(a={id:c.id,selector:c.selector,data:c.data,elements:[]},l[c.id]=a,u.push(a)),a.elements.push(s);return u.sort(p)},n.prototype.matches=function(e){if(!e)return[];var t,r,n,o,s,i,a,c,l,u,h,d=this.activeIndexes,f={},m=[];for(t=0,o=d.length;t<o;t++)if(c=(a=d[t]).element(e)){for(r=0,s=c.length;r<s;r++)if(l=a.map.get(c[r]))for(n=0,i=l.length;n<i;n++)!f[h=(u=l[n]).id]&&this.matchesSelector(e,u.selector)&&(f[h]=!0,m.push(u))}return m.sort(p)};var d={},f={},m=new WeakMap,v=new WeakMap,y=new WeakMap,g=Object.getOwnPropertyDescriptor(Event.prototype,"currentTarget");function b(e,t,r){var n=e[t];return e[t]=function(){return r.apply(e,arguments),n.apply(e,arguments)},e}function w(){m.set(this,!0)}function x(){m.set(this,!0),v.set(this,!0)}function C(){return y.get(this)||null}function S(e,t){g&&Object.defineProperty(e,"currentTarget",{configurable:!0,enumerable:!0,get:t||g.get})}function B(e){if(function(e){try{return e.eventPhase,!0}catch(e){return!1}}(e)){var t=(1===e.eventPhase?f:d)[e.type];if(t){var r=function(e,t,r){var n=[],o=t;do{if(1!==o.nodeType)break;var s=e.matches(o);if(s.length){var i={node:o,observers:s};r?n.unshift(i):n.push(i)}}while(o=o.parentElement)return n}(t,e.target,1===e.eventPhase);if(r.length){b(e,"stopPropagation",w),b(e,"stopImmediatePropagation",x),S(e,C);for(var n=0,o=r.length;n<o&&!m.get(e);n++){var s=r[n];y.set(e,s.node);for(var i=0,a=s.observers.length;i<a&&!v.get(e);i++)s.observers[i].data.call(s.node,e)}y.delete(e),S(e)}}}}function R(e,t,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=!!o.capture,i=s?f:d,a=i[e];a||(a=new n,i[e]=a,document.addEventListener(e,B,s)),a.add(t,r)}function T(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=!!n.capture,s=o?f:d,i=s[e];i&&(i.remove(t,r),i.size||(delete s[e],document.removeEventListener(e,B,o)))}function k(e,t,r){return e.dispatchEvent(new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:r}))}},18870:(e,t,r)=>{r.r(t),r(77757);var n=r(78134),o=r(39595),s=r(97797),i=r(87904);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i}let l=class CreateBranchElement extends HTMLElement{set error(e){this.errorContainer.innerHTML=e||""}set result(e){this.resultContainer.innerHTML=e||""}set submitting(e){this.spinner.style.display=e?"inline":"none"}set baseRepoNwo(e){this.baseRepoName&&(this.baseRepoName.textContent=e,this.selectedNwo=e,this.renderSelectItems())}get repoDefaultBranch(){return this.sourceBranch?.getAttribute("data-default-branch")||null}renderSelectItems(){this.repos.map(e=>{let t=e.closest(".js-repo-select-label"),r=e.getAttribute("data-name")===this.selectedNwo;t?.classList.toggle("selected",r),e.checked=r})}reconcileSelection(){this.renderSelectItems()}openDialog(e){e.preventDefault();let t=this.details;t.open=!0,t.hidden=!1,t.removeAttribute("aria-hidden"),this.baseRepoNwo=this.defaultRepo}selectSourceBranch(){this.sourceBranchHeader&&this.changeSourceBranchButton&&(this.changeSourceBranchButton.hidden=!0,this.sourceBranchHeader.hidden=!1)}async setRepo(e){if(!this.sourceBranchDetails||!this.sourceBranch||!this.sourceBranchSpinner||!this.sourceBranchHeader)return;let t=e.target,r=t?.getAttribute("data-url"),n=t?.getAttribute("data-name");if(!r||!n)return;this.baseRepoNwo=n;let o=this.sourceBranchHeader.hidden,s=this.sourceBranchSpinner.content.cloneNode(!0);this.sourceBranchDetails.replaceWith(s),this.submitButton.disabled=!0;let a=await (0,i.Ts)(document,r);this.sourceBranch.replaceWith(a),this.sourceBranchHeader.hidden=o,this.submitButton.disabled=!1}async closeDialog(){if(this.developmentForm){let e=await (0,i.Ts)(document,this.sidebarUrl);this.sidebarContainer.replaceWith(e)}}flashMessage(e,t="notice"){let r=new n.i4(document.querySelector(".js-flash-template"),{className:`flash-${t}`,message:e}),o=document.importNode(r,!0),s=document.querySelector("#js-flash-container");for(let e of s.children)e.classList.contains("js-flash-template")||s.removeChild(e);s.appendChild(o)}async submit(e){e.preventDefault(),this.submitting=!0;let t=this.form,r=new FormData(t);r.append("repo",r.get("repo")||""),r.append("skip_error_flash","true"),r.delete("source_branch");let n=await fetch(t.action,{method:t.method,body:r,headers:{"X-Requested-With":"XMLHttpRequest"}}),o=await n.text();n.ok?(this.error=null,t.hidden=!0,this.dispatchEvent(new CustomEvent("created")),r.has("after_create")?this.result=o:(this.closeDialog(),this.flashMessage(o))):this.error=o,this.submitting=!1;let s=this.desktopLink?.href;s&&window.location.replace(s)}async checkTagMatchResult(e){let t=await e.detail.response.text();this.error=t||null}selectRef(e){let t=e.currentTarget;if(!t)return;let r=document.querySelector(".js-selected-branch"),n=t.querySelector("input"),o=document.querySelector("create-branch ref-selector"),i=document.querySelector("create-branch #source-branch-input");r.textContent=n.value,i.value=n.value,t.closest("details").open=!1,setTimeout(()=>{(0,s.h)(o,"input-entered","")})}constructor(...e){super(...e),a(this,"defaultRepo",""),a(this,"defaultSourceBranch",""),a(this,"selectedNwo",""),a(this,"sidebarUrl","")}};c([o.aC],l.prototype,"form",void 0),c([o.aC],l.prototype,"developmentForm",void 0),c([o.aC],l.prototype,"spinner",void 0),c([o.aC],l.prototype,"errorContainer",void 0),c([o.aC],l.prototype,"details",void 0),c([o.aC],l.prototype,"resultContainer",void 0),c([o.aC],l.prototype,"baseRepoName",void 0),c([o.zV],l.prototype,"repos",void 0),c([o.aC],l.prototype,"desktopLink",void 0),c([o.aC],l.prototype,"changeSourceBranchButton",void 0),c([o.aC],l.prototype,"sourceBranch",void 0),c([o.aC],l.prototype,"sourceBranchHeader",void 0),c([o.aC],l.prototype,"sourceBranchSpinner",void 0),c([o.aC],l.prototype,"sourceBranchDetails",void 0),c([o.aC],l.prototype,"submitButton",void 0),c([o.aC],l.prototype,"sidebarContainer",void 0),c([o.CF],l.prototype,"defaultRepo",void 0),c([o.CF],l.prototype,"defaultSourceBranch",void 0),c([o.CF],l.prototype,"selectedNwo",void 0),c([o.CF],l.prototype,"sidebarUrl",void 0),l=c([o.p_],l)},87904:(e,t,r)=>{r.d(t,{Ee:()=>i,b4:()=>a,Ts:()=>s});let n=class ResponseError extends Error{constructor(e,t){super(`${e} for HTTP ${t.status}`),function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"response",void 0),this.response=t,this.name="ResponseError"}};var o=r(84076);async function s(e,t,r){let s=new Request(t,r);s.headers.append("X-Requested-With","XMLHttpRequest");let i=await self.fetch(s);if(i.status<200||i.status>=300)throw Error(`HTTP ${i.status}${i.statusText||""}`);return!function(e,t,r=!1){let o=t.headers.get("content-type")||"";if(!r&&!o.startsWith("text/html"))throw new n(`expected response with text/html, but was ${o}`,t);if(r&&!(o.startsWith("text/html")||o.startsWith("application/json")))throw new n(`expected response with text/html or application/json, but was ${o}`,t);let s=t.headers.get("x-html-safe");if(s){if(!e.includes(s))throw new n("response X-HTML-Safe nonce did not match",t)}else throw new n("missing X-HTML-Safe nonce",t)}(function(e){let t=[...e.querySelectorAll("meta[name=html-safe-nonce]")].map(e=>e.content);if(t.length<1)throw Error("could not find html-safe-nonce on document");return t}(e),i),(0,o.B)(e,await i.text())}function i(e,t,r=1e3,n=[200],o=[202]){return async function r(s){let i=new Request(e,t);i.headers.append("X-Requested-With","XMLHttpRequest");let a=await self.fetch(i);if(o.includes(a.status))return await new Promise(e=>setTimeout(e,s)),r(1.5*s);if(n.includes(a.status))return a;if(a.status<200||a.status>=300)throw Error(`HTTP ${a.status}${a.statusText||""}`);throw Error(`Unexpected ${a.status} response status from poll endpoint`)}(r)}async function a(e,t,r){let{wait:n=500,acceptedStatusCodes:o=[200],max:s=3,attempt:i=0}=r||{},c=async()=>new Promise((r,a)=>{setTimeout(async()=>{try{let n=new Request(e,t);n.headers.append("X-Requested-With","XMLHttpRequest");let a=await self.fetch(n);if(o.includes(a.status)||i+1===s)return r(a);r("retry")}catch(e){a(e)}},n*i)}),l=await c();return"retry"!==l?l:a(e,t,{wait:n,acceptedStatusCodes:o,max:s,attempt:i+1})}},84076:(e,t,r)=>{r.d(t,{B:()=>n});function n(e,t){let r=e.createElement("template");return r.innerHTML=t,e.importNode(r.content,!0)}}}]);
//# sourceMappingURL=app_components_branch_create-branch-element_ts-a50d9a3abc73.js.map